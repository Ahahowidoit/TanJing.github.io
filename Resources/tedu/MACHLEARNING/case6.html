
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>CASE</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="index.files/jquery.min.js">
    </script>
    <script type="text/javascript" src="index.files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="index.files/main.js">
    </script>
    <link type="text/css" href="index.files/index.css" rel="Stylesheet" />
    <link type="text/css" href="index.files/jquery.snippet.css" rel="Stylesheet" />
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor" />
      <a id="link_top" href="#page_top_case">Top</a>
      <h1>DME MACHLEARNING DAY06</h1>
      <ol class="index">
        <li>
          <a href="#case1">使用k均值算法对鸢尾花进行聚类</a>
        </li>
        <li>
          <a href="#case2">航空公司客户价值分析</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 使用k均值算法对鸢尾花进行聚类</h2>
      <h3>1.1 问题</h3>
      <p>基于鸢尾花数据集搭建k-means聚类模型</p>
      <h3>1.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p>加载所需的库和函数</p>
      <p>读取所需要的鸢尾花数据集</p>
      <p>对数据进行标准化处理</p>
      <p>建立KMeans模型，构建并训练模型</p>
      <p>将聚类结果可视化展示</p>
      <h3>1.3 代码</h3>
      <p>完整代码如下：</p>
      <pre class="code">import numpy as np
import pandas as pd
import sklearn.datasets as sd

iris_data=sd.load_iris()
# iris_data

# 鸢尾花 数据集 
# data：四列  

# iris_data

# 特征  花萼长度 花萼宽度 花瓣长度 花瓣宽度
X=iris_data['data']
# X

# 特征名称
iris_data['feature_names']

from sklearn.cluster import KMeans

model=KMeans(n_clusters=3,random_state=123).fit(X)
model

# 聚类中心
# 三行：012对应的聚类中心
# 四列：四个特征
model.cluster_centers_

# 聚类标签
model.labels_

s=pd.Series(model.labels_)
s.value_counts()

# 评价聚类模型  确定k的取值
# 核心：没有真实标签
# 评价标准：类内距离最小化  类间距离最大化
# CH指数 类间距/类内距  越大越好
# CH指数(特征 模型预测的标签)

import sklearn.metrics as sm

for i in range(2,8):
    model_kmeans=KMeans(n_clusters=i,random_state=123).fit(X)
    score=sm.calinski_harabasz_score(X,model_kmeans.labels_)
    print(i,score)

# 聚类结果可视化  

# 4个特征  三个类别

# 特征降成二维
from sklearn.manifold import TSNE
tsne=TSNE(n_components=2,random_state=100).fit(X)
# 降维之后的数据
# tsne.embedding_

# 把降维之后的数据 放入df中
df=pd.DataFrame(tsne.embedding_)
df.columns=['x','y']
df['label']=model.labels_
# df

df0=df[df['label']==0]
df1=df[df['label']==1]
df2=df[df['label']==2]

# df0

# 可视化
import matplotlib.pyplot as plt
plt.figure(figsize=(8,6),dpi=100)
plt.scatter(df0.x,df0.y,c='r',marker='*')
plt.scatter(df1.x,df1.y,c='g',marker='*')
plt.scatter(df2.x,df2.y,c='b',marker='*')
plt.show()
</pre>
      <a name="case2">
      </a>
      <h2>2 航空公司客户价值分析</h2>
      <h3>2.1 问题</h3>
      <p>对航空公司客户进行价值分析</p>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p>将航空公司客户数据采用pandas读取</p>
      <p>对数据进行描述性分析</p>
      <p>选择特征</p>
      <p>数据处理</p>
      <p>导入k均值算法，训练模型</p>
      <p>得到聚类中心，聚类标签</p>
      <p>分析每一个组的聚类中心，定义标签，制定相应的营销方案</p>
      <h3>2.3 代码</h3>
      <p>完整代码如下：</p>
      <pre class="code"># 数据读取
import pandas as pd
import numpy as np
airline_data=pd.read_csv('../data/air_data.csv'
                         ,encoding='gb18030')

import warnings
warnings.filterwarnings('ignore')

airline_data.head()


### 数据描述性分析

airline_data.info()

### 数据预处理&lt;br&gt;
#### 1. 去除票价为空的数据


exp1=airline_data['SUM_YR_1'].notnull()
exp2=airline_data['SUM_YR_2'].notnull()
exp=exp1&amp;exp2
airline_notnull=airline_data.loc[exp,:]
airline_notnull.shape

#### 2.只保留票价不为0，平均折扣率不为0，总飞行公里数大于0的记录。

index1=airline_notnull['SUM_YR_1']!=0
index2=airline_notnull['SUM_YR_2']!=0
index3=(airline_notnull['avg_discount']!=0)&amp;(airline_notnull['SEG_KM_SUM']&gt;0)
airline=airline_notnull[(index1|index2)&amp;index3]
airline.shape


# 选择特征
airline_selection=airline[['LOAD_TIME','FFP_DATE',
                          'LAST_TO_END','FLIGHT_COUNT',
                          'SEG_KM_SUM','avg_discount']]
# airline_selection.info()

# 修改数据类型
airline_selection['LOAD_TIME']=pd.to_datetime(airline_selection['LOAD_TIME'])
airline_selection['FFP_DATE']=pd.to_datetime(airline_selection['FFP_DATE'])

# airline_selection.info()

# airline_selection

# 构建L特征
L=airline_selection['LOAD_TIME']-airline_selection['FFP_DATE']
L=np.round(L.dt.days/30,2)
L

# L特征和原有特征 进行横向堆叠
airline_features=pd.concat(objs=[L,airline_selection.iloc[:,2:]],axis=1)
airline_features

# 修改列名
airline_features=airline_features.rename(columns={0:'L'})
# airline_features

airline_features.describe()

# 标准差标准化
airline_features_scaled=(airline_features-airline_features.mean())/airline_features.std()
airline_features_scaled


from sklearn.cluster import KMeans
import sklearn.metrics as sm

for i in range(5,11):
    model=KMeans(n_clusters=i,random_state=123).fit(airline_features_scaled)
    score=sm.calinski_harabasz_score(airline_features_scaled,
                                    model.labels_)
    print(i,score)

kmeans_model=KMeans(n_clusters=5,random_state=123).fit(airline_features_scaled)
kmeans_model

# 得到聚类标签
kmeans_model.labels_

s=pd.Series(kmeans_model.labels_)
s.value_counts()

# 得到聚类中心 
# 五行：01234对应的聚类中心
# 五列：LRFMC五个特征
kmeans_model.cluster_centers_

# 分析不同类别的特点，定义客户价值标签，制定营销策略

df=pd.DataFrame(kmeans_model.cluster_centers_)
df

df.to_excel('df.xlsx')

# pip install openpyxl  xlrd

# 新建一个excel文件，把不同客户价值标签的数据放入不同的sheet表里

airline

airline_features['id']=airline['MEMBER_NO']
airline_features['label']=kmeans_model.labels_
# airline_features

# 把不同标签的数据 提取出来
airline_0=airline_features[airline_features['label']==0]
airline_1=airline_features[airline_features['label']==1]
airline_2=airline_features[airline_features['label']==2]
airline_3=airline_features[airline_features['label']==3]
airline_4=airline_features[airline_features['label']==4]

# 新建一个excel文件 
writer=pd.ExcelWriter('airline.xlsx')
airline_0.to_excel(writer,'重点培养客户')
airline_1.to_excel(writer,'vip客户')
airline_2.to_excel(writer,'一般保持客户')
airline_3.to_excel(writer,'一般客户&amp;流失倾向')
airline_4.to_excel(writer,'重点挽留客户')
writer.save()

</pre>
    </div>
  </body>
</html>